<div class="app-container">
  <aside class="sidebar" [class.collapsed]="menuCollapsed">
    <div class="logo-section">
      <div class="logo-content" [class.hidden]="menuCollapsed">
        <div class="logo-wrapper">
          <div class="logo-icon"><span>K</span></div>
          <div class="logo-text"><h1>KOZZY</h1><p>Distribuidora</p></div>
        </div>
      </div>
    </div>
    <nav class="navigation">
      <ul class="menu-list">
        <li *ngFor="let item of menuItems">
          <ng-container *ngIf="item.action">
            <button (click)="item.action()" class="menu-item" [class.active]="item.active">
              <span class="menu-icon">{{ item.icon }}</span>
              <span class="menu-label" [class.hidden]="menuCollapsed">{{ item.label }}</span>
            </button>
          </ng-container>
          <ng-container *ngIf="item.route">
            <a [routerLink]="item.route" routerLinkActive="active" class="menu-item">
              <span class="menu-icon">{{ item.icon }}</span>
              <span class="menu-label" [class.hidden]="menuCollapsed">{{ item.label }}</span>
            </a>
          </ng-container>
        </li>
      </ul>
    </nav>
    <div class="user-section">
      <div class="user-info" [class.hidden]="menuCollapsed" *ngIf="usuarioLogado">
         <div class="user-avatar"><span>{{ usuarioLogado.nome?.charAt(0)?.toUpperCase() }}</span></div>
         <div class="user-details"><p class="user-name">{{ usuarioLogado.nome }}</p><p class="user-email">{{ usuarioLogado.email }}</p></div>
      </div>
      <button (click)="logout()" class="logout-btn" [class.collapsed]="menuCollapsed" title="Sair"><span class="icon">â†ª</span><span [class.hidden]="menuCollapsed">Sair</span></button>
    </div>
  </aside>

  <main class="main-content">
    
    <ng-container *ngIf="!showRelatorioScreen && !showDetailScreen">
      <header class="header">
        <div class="header-content">
          <div class="header-title"><h1>VisÃ£o Geral do Supervisor</h1><p>Monitoramento em tempo real dos chamados da equipe</p></div>
        </div>
      </header>

      <div class="content">
        <div class="stats-grid">
          <div class="stat-card" *ngFor="let kpi of kpis">
            <div class="stat-content">
              <div class="stat-icon" [class]="'stat-icon-' + kpi.color"><span>{{ kpi.icon }}</span></div>
              <div class="stat-info"><p class="stat-label">{{ kpi.label }}</p><p class="stat-value" [class]="'stat-value-' + kpi.color">{{ kpi.value }}</p></div>
            </div>
          </div>
        </div>

        <div class="filters-section">
          <div class="filters-list">
            <button (click)="setFilter('status', 'todos')" [class.active]="filtros.status === 'todos'" class="filter-btn">Todos</button>
            <button (click)="setFilter('status', 'aberto')" [class.active]="filtros.status === 'aberto'" class="filter-btn">Abertos</button>
            <button (click)="setFilter('status', 'em-andamento')" [class.active]="filtros.status === 'em-andamento'" class="filter-btn">Em Andamento</button>
            <button (click)="setFilter('status', 'fechado')" [class.active]="filtros.status === 'fechado'" class="filter-btn">ConcluÃ­dos</button>
          </div>
        </div>

        <div class="chamados-grid">
          <div *ngFor="let chamado of getChamadosFiltrados()" 
               class="chamado-card"
               (click)="onSelectChamado(chamado)">
             <div class="card-header"><span class="card-number">#{{ chamado.numeroProtocolo }}</span><span class="status-badge" [class]="getStatusClass(chamado.status)">{{ getStatusLabel(chamado.status) }}</span></div>
             <div class="card-content">
                <h3 class="card-title">{{ chamado.cliente }}</h3>
                <p class="card-description">{{ chamado.descricao }}</p>
                <div class="card-details">
                    <div class="detail-item"><p class="detail-label">Departamento</p><p class="detail-value">{{ chamado.area || 'Geral' }}</p></div>
                    <div class="detail-item"><p class="detail-label">Atendente</p><p class="detail-value">{{ chamado.atendente }}</p></div>
                </div>
             </div>
             <div class="card-footer"><span class="card-meta">ðŸ“… {{ formatarData(chamado.dataAbertura) }}</span><a class="details-btn">Ver detalhes â†’</a></div>
          </div>
        </div>
        
        <div *ngIf="getChamadosFiltrados().length === 0" class="empty-state">
            <div class="empty-icon">ðŸ“¥</div><h3>Nenhum chamado encontrado</h3><p>NÃ£o hÃ¡ chamados para exibir.</p>
        </div>
      </div>
    </ng-container>

    <app-ticket-detail
        *ngIf="showDetailScreen && chamadoDetalhe"
        [chamado]="chamadoDetalhe"
        [usuarioLogado]="usuarioLogado"
        (close)="fecharTelaDetalhes()"
        (edit)="onEditarAPartirDoDetalhe($event)">
    </app-ticket-detail>

    <app-relatorio-screen 
        *ngIf="showRelatorioScreen" 
        [chamados]="relatorioChamados" 
        (closeReportScreen)="fecharRelatorioScreen()"
        (chamadoSelecionado)="onSelectChamado($event)"> </app-relatorio-screen>

  </main>
</div>

<app-create-ticket-modal
  [isVisible]="showTicketModal"
  [chamadoParaEditar]="chamadoSelecionado"
  [perfilUsuario]="authService.getUsuarioLogado()?.perfil || 'supervisor'"
  [usuarioLogadoNome]="usuarioLogado?.nome || ''"
  (closeModal)="fecharTicketModal()"
  (chamadoCriado)="onChamadoCriado($event)"
  (chamadoAtualizado)="onChamadoAtualizado($event)">
</app-create-ticket-modal>

<app-criar-usuario-modal
    [isVisible]="showCriarUsuarioModal"
    (closeModal)="fecharModalCriarUsuario()"
    (usuarioCriado)="onUsuarioCriado($event)">
</app-criar-usuario-modal>

<app-relatorio-filtro-modal 
    [isVisible]="showRelatorioFiltrosModal" 
    [filtrosSalvos]="null"
    (closeModal)="fecharModalRelatorioFiltros()" 
    (gerarRelatorioEvent)="onGerarRelatorio($event)">
</app-relatorio-filtro-modal>

<app-search-protocol-modal
  [isVisible]="showSearchModal"
  (close)="fecharModalBusca()"
  (search)="onBuscarProtocolo($event)">
</app-search-protocol-modal>
    
<div class="toast-container" [class.show]="toast.visible" *ngIf="toast.visible">
  <div class="toast" [class]="'toast-' + toast.type">{{ toast.message }}</div>
</div>