<div 
  class="modal-overlay" 
  *ngIf="isVisible"
  (click)="onOverlayClick($event)"
  [@fadeIn]
>
  <div class="modal-container" [@slideIn]>
    <div class="modal-header">
      <h2 class="modal-title">
        <span *ngIf="!showPreview">üìù Criar Novo Chamado</span>
        <span *ngIf="showPreview">üëÅÔ∏è Preview do Chamado</span>
      </h2>
      <button 
        class="close-button" 
        (click)="closeModalHandler()"
        aria-label="Fechar modal"
        type="button"
      >
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      
      <form [formGroup]="ticketForm" *ngIf="!showPreview" class="ticket-form">
        
        <div class="form-group">
          <label for="numeroProtocolo" class="form-label required">
            N¬∫ do Protocolo
            <span class="field-info">*</span>
          </label>
          <input
            type="text"
            id="numeroProtocolo"
            formControlName="numeroProtocolo"
            class="form-input"
            [class.error]="hasFieldError('numeroProtocolo')"
            placeholder="Ex: 10242, 10243..."
            maxlength="10"
          >
          <div class="field-hint">
            <small>üí° Futuramente ser√° gerado automaticamente pelo sistema</small>
          </div>
          <div class="error-message" *ngIf="hasFieldError('numeroProtocolo')">
            {{ getFieldError('numeroProtocolo') }}
          </div>
        </div>

        <div class="form-group">
          <label for="cliente" class="form-label required">
            Tipo de Cliente
            <span class="field-info">*</span>
          </label>
          <select
            id="cliente"
            formControlName="cliente"
            class="form-select"
            [class.error]="hasFieldError('cliente')"
          >
            <option value="">Selecione o tipo de cliente</option>
            <option 
              *ngFor="let option of clienteOptions" 
              [value]="option.value"
            >
              {{ option.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="hasFieldError('cliente')">
            {{ getFieldError('cliente') }}
          </div>
        </div>

        <div class="form-group">
          <label for="assunto" class="form-label required">
            Categoria do Assunto
            <span class="field-info">*</span>
          </label>
          <select
            id="assunto"
            formControlName="assunto"
            class="form-select"
            [class.error]="hasFieldError('assunto')"
          >
            <option value="">Selecione a categoria do assunto</option>
            <option 
              *ngFor="let option of assuntoOptions" 
              [value]="option.value"
            >
              {{ option.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="hasFieldError('assunto')">
            {{ getFieldError('assunto') }}
          </div>
        </div>

        <div class="form-group" *ngIf="isEditMode && perfilUsuario === 'supervisor'">
          <label for="atendente" class="form-label required">
            Atendente Respons√°vel
            <span class="field-info">*</span>
          </label>
          <select id="atendente" formControlName="atendente" class="form-select" [class.error]="hasFieldError('atendente')">
            <option value="">Selecione o atendente respons√°vel</option>
            <option *ngFor="let option of atendenteOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="hasFieldError('atendente')">
            {{ getFieldError('atendente') }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="data" class="form-label required">
              Data do Atendimento
              <span class="field-info">*</span>
            </label>
            <input
              type="date"
              id="data"
              formControlName="data"
              class="form-input readonly"
              readonly
            >
            <div class="field-hint">
              <small>üìÖ Data preenchida automaticamente</small>
            </div>
          </div>

          <div class="form-group">
            <label for="hora" class="form-label required">
              Hor√°rio
              <span class="field-info">*</span>
            </label>
            <input
              type="time"
              id="hora"
              formControlName="hora"
              class="form-input readonly"
              readonly
            >
            <div class="field-hint">
              <small>üïê Hor√°rio preenchido automaticamente</small>
            </div>
          </div>
        </div>

        <div class="form-group" *ngIf="isEditMode && perfilUsuario === 'supervisor'">
          <label for="prioridade" class="form-label">
            N√≠vel de Prioridade
            <span class="field-optional">(opcional)</span>
          </label>
          <select
            id="prioridade"
            formControlName="prioridade"
            class="form-select"
          >
            <option 
              *ngFor="let option of prioridadeOptions" 
              [value]="option.value"
            >
              {{ option.label }}
            </option>
          </select>
          <div class="field-hint">
            <small>‚ö° Padr√£o: M√©dia prioridade</small>
          </div>
        </div>

        <div class="form-group">
          <label for="descricao" class="form-label">
            Descri√ß√£o Detalhada
            <span class="field-optional">(opcional)</span>
          </label>
          <textarea
            id="descricao"
            formControlName="descricao"
            class="form-textarea"
            placeholder="Descreva detalhadamente o problema ou solicita√ß√£o do cliente..."
            rows="4"
            maxlength="500"
          ></textarea>
          <div class="field-hint">
            <small>{{ ticketForm.get('descricao')?.value?.length || 0 }}/500 caracteres</small>
          </div>
        </div>

      </form>

      <div *ngIf="showPreview" class="preview-container">
        <div class="preview-card">
          <h3 class="preview-title">üìã Resumo do Chamado</h3>
          
          <div class="preview-grid">
            <div class="preview-item">
              <span class="preview-label">N¬∫ do Protocolo:</span>
              <span class="preview-value protocol-number">#{{ getPreviewData().numeroProtocolo }}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Tipo de Cliente:</span>
              <span class="preview-value">{{ getPreviewData().cliente }}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Categoria:</span>
              <span class="preview-value">{{ getPreviewData().assunto }}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Atendente:</span>
              <span class="preview-value">{{ getPreviewData().atendente }}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Data/Hora:</span>
              <span class="preview-value">{{ getPreviewData().dataHora }}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Prioridade:</span>
              <span class="preview-value priority" [class]="getPriorityClass()">
                {{ getPreviewData().prioridade }}
              </span>
            </div>
            
            <div class="preview-item full-width" *ngIf="getPreviewData().descricao">
              <span class="preview-label">Descri√ß√£o:</span>
              <span class="preview-value description">{{ getPreviewData().descricao }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="modal-footer">
      
      <div *ngIf="!showPreview" class="footer-buttons">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeModalHandler()"
        >
          ‚ùå Cancelar
        </button>
        
        <button 
          type="button" 
          class="btn btn-outline" 
          (click)="showPreviewHandler()"
          [disabled]="!isFormValid()"
        >
          üëÅÔ∏è Visualizar
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="salvarChamado()"
          [disabled]="!isFormValid() || isLoading"
        >
          <span *ngIf="!isLoading">üíæ Criar Chamado</span>
          <span *ngIf="isLoading" class="loading-content">
            <span class="spinner"></span>
            Criando...
          </span>
        </button>
      </div>

      <div *ngIf="showPreview" class="footer-buttons">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="backToForm()"
        >
          ‚Üê Editar
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="salvarChamado()"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">‚úÖ Confirmar e Criar</span>
          <span *ngIf="isLoading" class="loading-content">
            <span class="spinner"></span>
            Criando...
          </span>
        </button>
      </div>

    </div>

  </div>
</div>

<div 
  class="toast" 
  [class]="getToastClass()"
  *ngIf="toast.visible"
  [@fadeIn]
>
  <div class="toast-content">
    <span class="toast-icon">{{ getToastIcon() }}</span>
    <span class="toast-message">{{ toast.message }}</span>
    <button 
      class="toast-close" 
      (click)="hideToast()"
      aria-label="Fechar notifica√ß√£o"
    >
      ‚úï
    </button>
  </div>
</div>